<app-siderbar></app-siderbar>

<div class="main-content">
  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-10 col-xl-8">
        <!-- Header -->
        <div class="header mt-md-5">
          <div class="header-body">
            <div class="row align-items-center">
              <div class="col">
                <!-- Pretitle -->
                <h6 class="header-pretitle">Módulo</h6>

                <!-- Title -->
                <h1 class="header-title">Clientes</h1>
              </div>
            </div>
            <!-- / .row -->
          </div>
        </div>

        <!-- Alert -->

        <!-- Card -->
        <div class="card">
          <div class="card-header">
            <!-- Title -->
            <h2 class="card-header-title">Mostrando todos tus clientes</h2>
            <a
              class="btn btn-primary mr-3"
              [routerLink]="['/panel/clientes/registro']"
              >Registrar nuevo<i
                class="cxi-angle-right font-size-base align-middle ml-1"
              ></i
            ></a>
            <p class="font-size-sm font-weight-medium pl-md-4"></p>
          </div>
          <div class="card-body">
            <div class="input-group input-group-merge">
              <form class="form-inline pt-2">
                <label class="sr-only" for="inline-form-input-name"
                  >Apellidos</label
                >
                <input
                  class="form-control mb-3 mr-sm-4"
                  type="text"
                  (keyup)="filtro('apellidos')"
                  name="filtro_apellidos"
                  [(ngModel)]="filtro_apellidos"
                  placeholder="Apellidos"
                />
                <label class="sr-only" for="inline-form-input-username"
                  >Correo</label
                >
                <div class="input-group mb-3 mr-sm-4">
                  <div class="input-group-prepend">
                    <div class="input-group-text">@</div>
                  </div>
                  <input
                    class="form-control"
                    type="text"
                    name="filtro_correo"
                    (keyup)="filtro('correo')"
                    [(ngModel)]="filtro_correo"
                    placeholder="Correo"
                  />
                </div>
              </form>
              <button
                class="btn btn-success mb-3 text-dark"
                type="button"
                (click)="donwload_excel()"
              >
                Exportar a Excel
              </button>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-md table-nowrap card-table">
              <thead>
                <tr>
                  <th>Cliente</th>
                  <th>Correo</th>
                  <th>Teléfono</th>
                  <th>Opciones</th>
                </tr>
              </thead>
              <tbody class="h3">
                <!-- font-size-medium -->
                <tr
                  *ngFor="
                    let item of clientes
                      | slice
                        : (page - 1) * pageSize
                        : (page - 1) * pageSize + pageSize
                  "
                >
                  <td>
                    <a class="text-primary"
                      >{{ item.nombres }} {{ item.apellidos }}</a
                    >
                  </td>
                  <td>
                    {{ item.email }}
                  </td>

                  <td>
                    <span *ngIf="item.telefono">{{ item.telefono }}</span>
                    <span *ngIf="!item.telefono">No registrado</span>
                  </td>
                  <td>
                    <div class="dropdown">
                      <button
                        class="btn btn-secondary dropdown-toggle"
                        type="button"
                        id="dropdownMenuButtonAlias"
                        data-toggle="dropdown"
                        aria-haspopup="true"
                        aria-expanded="false"
                      >
                        Opciones
                      </button>
                      <div class="dropdown-menu">
                        <a
                          [routerLink]="['/panel/clientes', item._id]"
                          class="dropdown-item"
                          >Editar</a
                        >
                        <a
                          class="dropdown-item"
                          style="cursor: pointer"
                          data-toggle="modal"
                          [attr.data-target]="'#delete-' + item._id"
                          >Eliminar</a
                        >
                      </div>
                    </div>

                    <div
                      class="modal fade"
                      id="delete-{{ item._id }}"
                      tabindex="-1"
                      style="display: none"
                      aria-hidden="true"
                    >
                      <div
                        class="modal-dialog modal-dialog-centered"
                        role="document"
                      >
                        <div class="modal-content">
                          <div class="modal-header">
                            <h2 class="modal-title">
                              Eliminar, {{ item.nombres }}
                              {{ item.apellidos }}
                            </h2>
                            <button
                              class="close"
                              type="button"
                              data-dismiss="modal"
                              aria-label="Close"
                            >
                              <span aria-hidden="true">x</span>
                            </button>
                          </div>
                          <div class="modal-body h2">
                            <p>¿Desea eliminar este cliente?</p>
                          </div>
                          <div class="modal-footer">
                            <button
                              class="btn btn-secondary btn-md"
                              type="button"
                              data-dismiss="modal"
                            >
                              Cancelar
                            </button>
                            <button
                              class="btn btn-primary btn-shadow btn-md"
                              type="button"
                              (click)="eliminar(item._id)"
                            >
                              Sí, eliminar
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <ngb-pagination
          *ngIf="clientes.length >= 1"
          [(page)]="page"
          [pageSize]="pageSize"
          [maxSize]="10"
          [rotate]="true"
          [boundaryLinks]="true"
          [collectionSize]="clientes.length"
        ></ngb-pagination>

        <br />
      </div>
    </div>
    <!-- / .row -->
  </div>
</div>
